// Pressure v0.0.1 alpha | Created By Stuart Yamartino | MIT License | 2015 
!function(e,t){function n(){this.touchDown=!1}var o={supported:function(e,t){i.checkSupport(e)},change:function(e,t,n){r.changePressure(e,t,n)}},r={changePressure:function(e,t,n){c.build(e,t,function(){"force"===u.type&&"force"===n?c.changeForceTouch(e,t):"3d"===u.type&&"3d"===n?c.change3DTouch(e,t):"force"===u.type&&"3d"!==n?c.changeForceTouch(e,t):"3d"===u.type&&"force"!==n&&c.change3DTouch(e,t)}.bind(this))}},c={build:function(e,t,n){u.forPressure?n():u.hasRun?a(t)(d()):i.checkSupport({success:function(){n()},fail:a(t)})},changeForceTouch:function(e,t){l(p(e),function(e,n){n.addEventListener("webkitmouseforcechanged",function(e){f(t).call(n,e.webkitForce,e)},!1),n.addEventListener("webkitmouseforcewillbegin",function(e){e.preventDefault()}),t.hasOwnProperty("forceEnd")&&(n.addEventListener("mouseup",function(){t.forceEnd.call(n)}),n.addEventListener("mouseleave",function(){t.forceEnd.call(n)}))})},change3DTouch:function(e,t){l(p(e),function(e,o){var r=new n;o.addEventListener("touchstart",function(e){r.startCheckingForce(e,t,o)},!1),o.addEventListener("touchend",function(e){r.up()},!1)})}},i={checkSupport:function(e){u.hasRun?s(e):this.browserSupported()?this.testDeviceSupport(e):(u.browserFail(),s(e))},browserSupported:function(){return"onwebkitmouseforcewillbegin"in t||"ontouchstart"in t},testDeviceSupport:function(e){u.forPressure=!1,this.returnSupportBind=this.returnSupport.bind(this,e),t.addEventListener("webkitmouseforcewillbegin",this.touchForceEnabled,!1),t.addEventListener("mousedown",this.returnSupportBind,!1),t.addEventListener("touchstart",this.touch3DEnabled,!1),t.addEventListener("touchstart",this.returnSupportBind,!1)},removeDocumentListeners:function(){t.removeEventListener("webkitmouseforcewillbegin",this.touchForceEnabled),t.removeEventListener("mousedown",this.returnSupportBind),t.removeEventListener("touchstart",this.touch3DEnabled),t.removeEventListener("touchstart",this.returnSupportBind)},touchForceEnabled:function(){u.didSucceed("force")},touch3DEnabled:function(e){void 0!==e.touches[0].force&&u.didSucceed("3d")},returnSupport:function(e){this.removeDocumentListeners(),u.forPressure?s(e,"success"):(u.deviceFail(),s(e,"fail"))}};n.prototype.down=function(){this.touchDown=!0},n.prototype.up=function(){this.touchDown=!1},n.prototype.startCheckingForce=function(e,t,n){this.element=n,this.down(),this.touch=e.touches[0],this.touch&&this.fetchForce(e,t)},n.prototype.fetchForce=function(e,t){this.touchDown&&(this.touch=e.touches[0],setTimeout(this.fetchForce.bind(this),10,e,t),t.call(this.element,this.touch.force||0,e))};var u={hasRun:!1,forPressure:!1,type:"",failureType:"",browserFail:function(){this.didFail("browser")},deviceFail:function(){this.didFail("device")},didFail:function(e){this.hasRun=!0,this.forPressure=!1,this.failureType=e},didSucceed:function(e){this.hasRun=!0,this.forPressure=!0,this.type=e}},s=function(e){v(e)?h(e):u.forPressure&&e()},h=function(e){u.forPressure&&e.hasOwnProperty("success")?e.success():!u.forPressure&&e.hasOwnProperty("fail")&&e.fail(d())},f=function(e){return v(e)?e.hasOwnProperty("success")?e.success:void 0:e},a=function(e){var t=function(){};return v(e)&&e.hasOwnProperty("fail")&&(t=e.fail),t},d=function(){switch(u.failureType){case"browser":var e="Browser does not support Force Touch or 3D Touch.";break;case"device":var e="Device does not support Force Touch or 3D Touch."}return{error:{type:u.failureType,message:e}}},p=function(e){return t.querySelectorAll(e)},l=function(e,t,n){for(var o=0;o<e.length;o++)t.call(n,o,e[o])},v=function(e){return null!==e&&"object"==typeof e};e.Pressure=o}(window,document);