// Pressure v0.0.1 alpha | Created By Stuart Yamartino | MIT License | 2015 
!function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i={set:function(e,t){o.set(e,t)},setForceTouch:function(e,t){o.set(e,t,"force")},set3DTouch:function(e,t){o.set(e,t,"3d")}},o={set:function(e,t,n){d(e,function(e,s){var i=new u(s,t,n);i.routeEvents()})}},u=function(){function e(t,s,i){n(this,e),this.element=t,this.block=s,this.type=i}return s(e,[{key:"routeEvents",value:function(){h.mobile===!1&&"force"===this.type?this.addMouseEvents():h.mobile===!0&&"3d"===this.type?this.addTouchEvents():h.mobile===!1&&"3d"!==this.type?this.addMouseEvents():h.mobile===!0&&"force"!==this.type?this.addTouchEvents():this.failEvents()}},{key:"addMouseEvents",value:function(){this.element.addEventListener("webkitmouseforcewillbegin",this.touchForceEnabled,!1),this.always();var e=new c(this);e.bindEvents()}},{key:"addTouchEvents",value:function(){this.element.addEventListener("touchstart",this.touch3DEnabled,!1),this.always();var e=new r(this);e.bindEvents()}},{key:"always",value:function(){h.mobile?this.element.addEventListener("touchstart",this.dispatch.bind(this),!1):this.element.addEventListener("mousedown",this.dispatch.bind(this),!1)}},{key:"failEvents",value:function(){var e=this;h.mobile?this.element.addEventListener("touchstart",function(){return a(e.block,"unsupported")},!1):this.element.addEventListener("mousedown",function(){return a(e.block,"unsupported")},!1)}},{key:"touchForceEnabled",value:function(e){e.preventDefault(),h.didSucceed("force")}},{key:"touch3DEnabled",value:function(e){void 0!==e.touches[0].force&&h.didSucceed("3d")}},{key:"dispatch",value:function(){h.forPressure?(this.element.removeEventListener("webkitmouseforcewillbegin",this.touchForceEnabled),this.element.removeEventListener("touchstart",this.touch3DEnabled)):(h.didFail(),a(this.block,"unsupported",this.element))}}]),e}(),r=function(){function e(t){n(this,e),this.element=t,this.el=t.element,this.block=t.block,this.touchDown=!1}return s(e,[{key:"bindEvents",value:function(){this.start(),this.change(),this.end()}},{key:"start",value:function(){var e=this;this.block.hasOwnProperty("start")&&this.el.addEventListener("touchstart",function(){h.forPressure&&a(e.block,"start",e.el)},!1)}},{key:"change",value:function(){var e=this;this.block.hasOwnProperty("change")&&this.el.addEventListener("touchstart",function(t){h.forPressure&&(e.setDown(),e.touch=t.touches[0],e.touch&&e.fetchForce(t))},!1)}},{key:"end",value:function(){var e=this;this.block.hasOwnProperty("end")&&this.el.addEventListener("touchend",function(){h.forPressure&&(e.setUp(),a(e.block,"end",e.el))},!1)}},{key:"fetchForce",value:function(e){this.touchDown&&(this.touch=e.touches[0],setTimeout(this.fetchForce.bind(this),10,e),a(this.block,"change",this.el,this.touch.force||0,e))}},{key:"setDown",value:function(){this.touchDown=!0}},{key:"setUp",value:function(){this.touchDown=!1}}]),e}(),c=function(){function e(t){n(this,e),this.element=t,this.el=t.element,this.block=t.block,this.state="up"}return s(e,[{key:"bindEvents",value:function(){this.start(),this.change(),this.end(),this.preventDefaultForceTouch()}},{key:"start",value:function(){var e=this;this.block.hasOwnProperty("start")&&this.el.addEventListener("mousedown",function(){h.forPressure&&(e.setDown(),a(e.block,"start",e.el))},!1)}},{key:"change",value:function(){var e=this;this.block.hasOwnProperty("change")&&this.el.addEventListener("webkitmouseforcechanged",function(t){h.forPressure&&0!==t.webkitForce&&a(e.block,"change",e.el,e.normalizeForce(t.webkitForce),t)},!1)}},{key:"end",value:function(){var e=this;this.block.hasOwnProperty("end")&&(this.el.addEventListener("mouseup",function(){h.forPressure&&(e.setUp(),a(e.block,"end",e.el))},!1),this.el.addEventListener("mouseleave",function(){h.forPressure&&("down"===e.state&&a(e.block,"end",e.el),e.setUp())},!1))}},{key:"preventDefaultForceTouch",value:function(){this.el.addEventListener("webkitmouseforcewillbegin",function(e){h.forPressure&&e.preventDefault()},!1)}},{key:"setUp",value:function(){this.state="up"}},{key:"setDown",value:function(){this.state="down"}},{key:"normalizeForce",value:function(e){return(e-1)/2}}]),e}(),h={hasRun:!1,forPressure:!1,type:!1,didFail:function(){this.hasRun=!0,this.forPressure=!1},didSucceed:function(e){this.hasRun=!0,this.forPressure=!0,this.type=e}},a=function(e,t,n){e.hasOwnProperty(t)&&e[t].apply(n||this,Array.prototype.slice.call(arguments,3))},l=function(e){return t.querySelectorAll(e)},d=function(e,t,n){for(var s=l(e),i=0;i<s.length;i++)t.call(n,i,s[i])};h.mobile="ontouchstart"in t,e.Pressure=i}(window,document);