// Pressure v0.0.1 alpha | Created By Stuart Yamartino | MIT License | 2015 
!function(e,t){function o(){this.touchDown=!1}var n={supported:function(e,t){i.checkSupport(e)},change:function(e,t,o){r.changePressure(e,t,o)}},r={changePressure:function(e,t,o){c.build(e,t,function(){"force"===u.type&&"force"===o?c.changeForceTouch(e,t):"3d"===u.type&&"3d"===o?c.change3DTouch(e,t):"force"===u.type&&"3d"!==o?c.changeForceTouch(e,t):"3d"===u.type&&"force"!==o&&c.change3DTouch(e,t)}.bind(this))}},c={build:function(e,t,o){u.forPressure?o():u.hasRun?d(t)(a()):i.checkSupport({success:function(){o()},fail:d(t)})},changeForceTouch:function(e,t){l(p(e),function(e,o){o.addEventListener("webkitmouseforcechanged",function(e){f(t).call(o,e.webkitForce,e)},!1),o.addEventListener("webkitmouseforcewillbegin",function(e){e.preventDefault()})})},change3DTouch:function(e,t){l(p(e),function(e,n){var r=new o;n.addEventListener("touchstart",function(e){r.startCheckingForce(e,t,n)},!1),n.addEventListener("touchend",function(e){r.up()},!1)})}},i={checkSupport:function(e){u.hasRun?s(e):this.browserSupported()?this.testDeviceSupport(e):(u.browserFail(),s(e))},browserSupported:function(){return"onwebkitmouseforcewillbegin"in t||"ontouchstart"in t},testDeviceSupport:function(e){u.forPressure=!1,this.returnSupportBind=this.returnSupport.bind(this,e),t.addEventListener("webkitmouseforcewillbegin",this.touchForceEnabled,!1),t.addEventListener("mousedown",this.returnSupportBind,!1),t.addEventListener("touchstart",this.touch3DEnabled,!1),t.addEventListener("touchstart",this.returnSupportBind,!1)},removeDocumentListeners:function(){t.removeEventListener("webkitmouseforcewillbegin",this.touchForceEnabled),t.removeEventListener("mousedown",this.returnSupportBind),t.removeEventListener("touchstart",this.touch3DEnabled),t.removeEventListener("touchstart",this.returnSupportBind)},touchForceEnabled:function(){u.didSucceed("force")},touch3DEnabled:function(e){void 0!==e.touches[0].force&&u.didSucceed("3d")},returnSupport:function(e){this.removeDocumentListeners(),u.forPressure?s(e,"success"):(u.deviceFail(),s(e,"fail"))}};o.prototype.down=function(){this.touchDown=!0},o.prototype.up=function(){this.touchDown=!1},o.prototype.startCheckingForce=function(e,t,o){this.element=o,this.down(),this.touch=e.touches[0],this.touch&&this.fetchForce(e,t)},o.prototype.fetchForce=function(e,t){this.touchDown&&(this.touch=e.touches[0],setTimeout(this.fetchForce.bind(this),10,e,t),t.call(this.element,this.touch.force||0,e))};var u={hasRun:!1,forPressure:!1,type:"",failureType:"",browserFail:function(){this.didFail("browser")},deviceFail:function(){this.didFail("device")},didFail:function(e){this.hasRun=!0,this.forPressure=!1,this.failureType=e},didSucceed:function(e){this.hasRun=!0,this.forPressure=!0,this.type=e}},s=function(e){b(e)?h(e):u.forPressure&&e()},h=function(e){u.forPressure&&v(e,"success")?e.success():!u.forPressure&&v(e,"fail")&&e.fail(a())},f=function(e){return b(e)?v(e,"success")?e.success:void 0:e},d=function(e){var t=function(){};return b(e)&&v(e,"fail")&&(t=e.fail),t},a=function(){switch(u.failureType){case"browser":var e="Browser does not support Force Touch or 3D Touch.";break;case"device":var e="Device does not support Force Touch or 3D Touch."}return{error:{type:u.failureType,message:e}}},p=function(e){return t.querySelectorAll(e)},l=function(e,t,o){for(var n=0;n<e.length;n++)t.call(o,n,e[n])},v=function(e,t){var o=e.__proto__||e.constructor.prototype;return t in e&&(!(t in o)||o[t]!==e[t])},b=function(e){return null!==e&&"object"==typeof e};e.Pressure=n}(window,document);