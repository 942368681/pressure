// Pressure v0.0.1 alpha | Created By Stuart Yamartino | MIT License | 2015 
!function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o={set:function(e,t,n){h(e,t,null,n)},setForceTouch:function(e,t,n){h(e,t,"force",n)},set3DTouch:function(e,t,n){h(e,t,"3d",n)}},s=function(){function e(t,i,o){n(this,e),this.element=t,this.block=i,this.type=o}return i(e,[{key:"routeEvents",value:function(){c.mobile!==!1||"force"!==this.type&&"3d"===this.type?c.mobile!==!0||"3d"!==this.type&&"force"===this.type?this.failEvents():this.touch3DAdapter():this.touchForceAdapter()}},{key:"touchForceAdapter",value:function(){var e=new r(new u(this));e.handle()}},{key:"touch3DAdapter",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=new r(new touch3DAdapter(this));e.handle()})},{key:"failEvents",value:function(){var e=this;c.mobile?this.element.addEventListener("touchstart",function(){return a(e.block,"unsupported")},!1):this.element.addEventListener("mousedown",function(){return a(e.block,"unsupported")},!1)}}]),e}(),r=function(){function e(t){n(this,e),this.adapter=t}return i(e,[{key:"handle",value:function(){this.adapter.support(),this.adapter.block.hasOwnProperty("start")&&this.adapter.start(),this.adapter.block.hasOwnProperty("change")&&this.adapter.change(),this.adapter.block.hasOwnProperty("end")&&this.adapter.end()}}]),e}(),u=(function(){function e(t){n(this,e),this.element=t,this.el=t.element,this.block=t.block,this.touchDown=!1}return i(e,[{key:"support",value:function(){this.addListener("touchstart",this._dispatch.bind(this)),this.el.addEventListener("touchstart",this._dispatch.bind(this),!1)}},{key:"_dispatch",value:function(e){void 0!==e.touches[0].force?(c.didSucceed("3d"),this.el.removeEventListener("touchstart",this._dispatch.bind(this))):(c.didFail(),a(this.block,"unsupported",this.el))}},{key:"start",value:function(){var e=this;this.el.addEventListener("touchstart",function(){c.forPressure&&a(e.block,"start",e.el)},!1)}},{key:"change",value:function(){var e=this;this.el.addEventListener("touchstart",function(t){c.forPressure&&(e.setDown(),e.touch=e.selectTouch(t),e.touch&&e.fetchForce(t))},!1)}},{key:"end",value:function(){var e=this;this.el.addEventListener("touchend",function(){c.forPressure&&(e.setUp(),a(e.block,"end",e.el))},!1)}},{key:"_fetchForce",value:function(e){this.touchDown&&(this.touch=this.selectTouch(e),setTimeout(this.fetchForce.bind(this),10,e),a(this.block,"change",this.el,this.touch.force,e))}},{key:"_setDown",value:function(){this.touchDown=!0}},{key:"_setUp",value:function(){this.touchDown=!1}},{key:"_selectTouch",value:function(e){if(1===e.touches.length)return e.touches[0];for(var t=0;t<e.touches.length;t++)if(e.touches[t].target===this.el)return e.touches[t]}}]),e}(),function(){function e(t){n(this,e),this.element=t,this.el=t.element,this.block=t.block,this.state="up",this._preventDefaultForceTouch()}return i(e,[{key:"support",value:function(){this.el.addEventListener("webkitmouseforcewillbegin",this._touchForceEnabled,!1),this.el.addEventListener("mousedown",this._dispatch.bind(this),!1)}},{key:"_touchForceEnabled",value:function(e){e.preventDefault(),c.didSucceed("force")}},{key:"_dispatch",value:function(){c.forPressure?this.el.removeEventListener("webkitmouseforcewillbegin",this._touchForceEnabled):(c.didFail(),a(this.block,"unsupported",this.el))}},{key:"start",value:function(){var e=this;this.el.addEventListener("mousedown",function(){c.forPressure&&(e._setDown(),a(e.block,"start",e.el))},!1)}},{key:"change",value:function(){var e=this;this.el.addEventListener("webkitmouseforcechanged",function(t){c.forPressure&&0!==t.webkitForce&&a(e.block,"change",e.el,e._normalizeForce(t.webkitForce),t)},!1)}},{key:"end",value:function(){var e=this;this.el.addEventListener("mouseup",function(){c.forPressure&&(e._setUp(),a(e.block,"end",e.el))},!1),this.el.addEventListener("mouseleave",function(){c.forPressure&&("down"===e.state&&a(e.block,"end",e.el),e._setUp())},!1)}},{key:"_preventDefaultForceTouch",value:function(){this.el.addEventListener("webkitmouseforcewillbegin",function(e){c.forPressure&&e.preventDefault()},!1)}},{key:"_setUp",value:function(){this.state="up"}},{key:"_setDown",value:function(){this.state="down"}},{key:"_normalizeForce",value:function(e){return(e-1)/2}}]),e}()),c={hasRun:!1,forPressure:!1,type:!1,didFail:function(){this.hasRun=!0,this.forPressure=!1},didSucceed:function(e){this.hasRun=!0,this.forPressure=!0,this.type=e}},h=function(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],o=l(e),r=0;r<o.length;r++){i&&(o[r].style.webkitUserSelect="none");var u=new s(o[r],t,n);u.routeEvents()}},a=function(e,t,n){e.hasOwnProperty(t)&&e[t].apply(n||this,Array.prototype.slice.call(arguments,3))},l=function(e){return t.querySelectorAll(e)};c.mobile="ontouchstart"in t,e.Pressure=o}(window,document);