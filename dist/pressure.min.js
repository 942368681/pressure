// Pressure v0.0.4 | Created By Stuart Yamartino | MIT License | 2016 
!function(e){"use strict";function t(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e!==!1?e.document:!1,u={set:function(e,t,n){d(e,t,n)},map:function(e,t,n,o,s){return v(e,t,n,o,s)}},c=function(){function e(t,n,o){s(this,e),this.element=t,this.block=n,this.type=o.hasOwnProperty("only")?o.only:null,this.cssPrevention(o),this.routeEvents()}return i(e,[{key:"cssPrevention",value:function(e){e.hasOwnProperty("css")&&e.css===!1&&(this.element.style.webkitUserSelect="none",this.element.style.webkitTouchCallout="none")}},{key:"routeEvents",value:function(){f.mobile!==!1||"force"!==this.type&&"3d"===this.type?f.mobile!==!0||"3d"!==this.type&&"force"===this.type?this.failEvents():new l(this):new a(this)}},{key:"failEvents",value:function(){var e=this;this.element.addEventListener(f.mobile?"touchstart":"mousedown",function(){return y(e.block,"unsupported",e.element)},!1)}}]),e}(),h=function(){function e(t){s(this,e),this.element=t,this.el=t.element,this.block=t.block,this.down=!1,this.deepDown=!1}return i(e,[{key:"add",value:function(e,t){this.el.addEventListener(e,t,!1)}},{key:"remove",value:function(e,t){this.el.removeEventListener(e,t)}},{key:"_setDown",value:function(){this.down=!0}},{key:"_setUp",value:function(){this.down=!1}},{key:"_setDeepDown",value:function(){this.deepDown=!0}},{key:"_setDeepUp",value:function(){this.deepDown=!1}}]),e}(),l=function(e){function t(e){s(this,t);var o=n(this,Object.getPrototypeOf(t).call(this,e));return o.support(),o.start(),o.change(),o.end(),o}return o(t,e),i(t,[{key:"support",value:function(){this.supportMethod=this._middleMan.bind(this),this.add("touchstart",this.supportMethod)}},{key:"_middleMan",value:function(e){this._setDown(),this._dispatch(0,e)}},{key:"_dispatch",value:function(e,t){f.hasRun===!1?t.touches[0].force>0?(f.didSucceed("3d"),this.remove("touchstart",this.supportMethod),y(this.block,"start",this.el),this._changeLogic(t)):10>=e&&this.down===!0?(e+=1,setTimeout(this._dispatch.bind(this),10,e,t)):this.down===!0&&(f.didFail(),y(this.block,"unsupported",this.el)):f.forPressure?this.remove("touchstart",this.supportMethod):y(this.block,"unsupported",this.el)}},{key:"start",value:function(){var e=this;this.add("touchstart",function(){f.forPressure&&(e._setDown(),y(e.block,"start",e.el))})}},{key:"change",value:function(){this.add("touchstart",this._changeLogic.bind(this))}},{key:"_changeLogic",value:function(e){f.forPressure&&(this._setDown(),this.touch=this._selectTouch(e),this.touch&&this._fetchForce(e))}},{key:"end",value:function(){var e=this;this.add("touchend",function(){f.forPressure&&(e._setUp(),y(e.block,"end",e.el),e.endDeepPress())})}},{key:"startDeepPress",value:function(){this.deepDown===!1&&y(this.block,"startDeepPress",this.el),this._setDeepDown()}},{key:"endDeepPress",value:function(){this.deepDown===!0&&y(this.block,"endDeepPress",this.el),this._setDeepUp()}},{key:"_fetchForce",value:function(e){this.down&&(this.touch=this._selectTouch(e),setTimeout(this._fetchForce.bind(this),10,e),y(this.block,"change",this.el,this.touch.force,e))}},{key:"_selectTouch",value:function(e){if(1===e.touches.length)return this._returnTouch(e.touches[0].force);for(var t=0;t<e.touches.length;t++)if(e.touches[t].target===this.el)return this._returnTouch(e.touches[t])}},{key:"_returnTouch",value:function(e){return e.force>=.5?this.startDeepPress():this.endDeepPress(),e}}]),t}(h),a=function(e){function t(e){s(this,t);var o=n(this,Object.getPrototypeOf(t).call(this,e));return o.support(),o.start(),o.change(),o.end(),o.startDeepPress(),o.endDeepPress(),o._preventDefaultForceTouch(),o}return o(t,e),i(t,[{key:"support",value:function(){this.add("webkitmouseforcewillbegin",this._touchForceEnabled),this.add("mousedown",this._dispatch.bind(this))}},{key:"_touchForceEnabled",value:function(e){e.preventDefault(),f.didSucceed("force")}},{key:"_dispatch",value:function(){f.forPressure===!1?(f.didFail(),y(this.block,"unsupported",this.el)):this.remove("webkitmouseforcewillbegin",this._touchForceEnabled)}},{key:"start",value:function(){var e=this;this.add("mousedown",function(){f.forPressure&&(e._setDown(),y(e.block,"start",e.el))})}},{key:"change",value:function(){var e=this;this.add("webkitmouseforcechanged",function(t){f.forPressure&&0!==t.webkitForce&&y(e.block,"change",e.el,e._normalizeForce(t.webkitForce),t)})}},{key:"end",value:function(){var e=this;this.add("mouseup",function(){f.forPressure&&(e._setUp(),y(e.block,"end",e.el))}),this.add("mouseleave",function(){f.forPressure&&(e.down&&y(e.block,"end",e.el),e._setUp())})}},{key:"startDeepPress",value:function(){var e=this;this.add("webkitmouseforcedown",function(){f.forPressure&&(e._setDeepDown(),y(e.block,"startDeepPress",e.el))})}},{key:"endDeepPress",value:function(){var e=this;this.add("webkitmouseforceup",function(){f.forPressure&&(e._setDeepUp(),y(e.block,"endDeepPress",e.el))}),this.add("mouseleave",function(){f.forPressure&&(e.deepDown&&y(e.block,"endDeepPress",e.el),e._setDeepUp())})}},{key:"_preventDefaultForceTouch",value:function(){this.add("webkitmouseforcewillbegin",function(e){f.forPressure&&e.preventDefault()})}},{key:"_normalizeForce",value:function(e){return(e-1)/2}}]),t}(h),f={hasRun:!1,forPressure:!1,type:!1,didFail:function(){this.hasRun=!0,this.forPressure=!1},didSucceed:function(e){this.hasRun=!0,this.forPressure=!0,this.type=e}},d=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if("string"==typeof e||e instanceof String)for(var o=r.querySelectorAll(e),s=0;s<o.length;s++)new c(o[s],t,n);else if(p(e))new c(e,t,n);else for(var s=0;s<e.length;s++)new c(e[s],t,n)},p=function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":t(HTMLElement))?e instanceof HTMLElement:e&&"object"===("undefined"==typeof e?"undefined":t(e))&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},y=function(e,t,n){e.hasOwnProperty(t)&&e[t].apply(n||this,Array.prototype.slice.call(arguments,3))},v=function(e,t,n,o,s){return(e-t)*(s-o)/(n-t)+o};if(f.mobile="ontouchstart"in r,e===!1)throw new Error("Pressure requires a window with a document");"undefined"!=typeof u&&("function"==typeof define&&define.amd?define(["Pressure"],function(e){return e}):"object"===("undefined"==typeof module?"undefined":t(module))&&module.exports?module.exports=u:e.Pressure=u)}("undefined"!=typeof window?window:!1);